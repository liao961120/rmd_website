library(readr)
library(dplyr)
library(forcats) # manipulate factors

psy_test <- read_csv("./data/psy_test.csv")
item <- read_csv("data/item.csv",
                 col_types = cols(
                     item_num=col_character(),
                     question_num=col_character() ))

# variable information
vars <- colnames(psy_test)
vars_en <- c("time", "age", "gender", 
             "college", "dept", "grade", 1:62, 
             "fb1", "fb2", "fb3")
var_info <- as_data_frame(cbind(vars, vars_en)) %>%
    left_join(item, by= c("vars_en"="question_num")) %>%
    select(vars, vars_en, construct_en, type, question)
    
# converting to factors
colnames(psy_test) <- vars_en
psy_test <- psy_test %>%
    mutate(gender=factor(gender),
           college=factor(college),
           dept=factor(dept),
           grade=factor(grade)) %>%
    mutate(gender=fct_recode(gender,
                    "male"="男",
                    "female"="女",
                    "other"="其他")) %>%
    mutate(grade=fct_recode(grade,
                    "first"="一",
                    "first"="一年級",
                    "second"="二",
                    "third"="三",
                    "forth"="四",
                    "suspend" = "休學",
                    "NoDegree" = "未畢\\肄業",
                    "graduated" = "畢\\肄業")) %>%
    mutate(college=fct_recode(college,
                    "靜宜大學"="靜宜",
                    "靜宜大學"="?宜",
                    "臺灣大學"="ntu",
                    "臺灣大學"="Ntu",
                    "臺灣大學"="NTU",
                    "臺灣大學"="台大",
                    "臺灣大學"="台灣大學",
                    "臺灣大學"="國立台灣大學",
                    "臺灣大學"="國立臺灣大學",
                    "臺灣大學"="臺灣大學與中興大學 看你想要哪一個",
                    "台北大學"="國立台北大學",
                    "台北大學"="國立臺北大學",
                    "清華大學"="清大",
                    "清華大學"="國立清華大學",
                    "輔仁大學"="輔仁",
                    "臺灣師範大學"="國立臺灣師範大學",
                    "臺灣師範大學"="師大",
                    "臺灣師範大學"="台師大",
                    "台北科技大學"="北科",
                    "中原大學"="中原",
                    "中原大學"="中原大旋",
                    "中國醫藥大學"="中國醫",
                    "中興大學"="中興",
                    "文化大學"="文化",
                    "世新大學"="世新",
                    "臺北醫學大學"="北醫",
                    "臺北醫學大學"="台北醫學大學",
                    "臺北市立大學"="台北市立大學",
                    "國立臺北護理健康大學"="北護",
                    "國立臺北護理健康大學"="國北護",
                    "國立臺灣藝術大學"="台灣藝術大學",
                    "國立臺灣藝術大學"="台藝大",
                    "國立臺灣藝術大學"="國立台灣藝術大學",
                    "國立臺灣體育運動大學"="台灣體育運動大學",
                    "成功大學"="成大",
                    "成功大學"="國立成功大學",
                    "亞洲大學"="亞洲",
                    "東吳大學"="東吳",
                    "東海大學"="東海",
                    "屏東科技大學"="屏科",
                    "政治大學"="政大",
                    "陽明大學"="陽明",
                    "暨南大學"="國立暨南國際大學",
                    "淡江大學"="淡江",
                    "義守大學"="義守",
                    "實踐大學"="實踐",
                    "彰化師範大學"="彰師大",
                    "實踐大學"="實踐",
                    "輔仁大學"="輔大",
                    "輔仁大學"="輔仁",
                    "未知"="無",
                    "未知"="是",
                    "未知"="某某大學",
                    "未知"="0")) %>%
    mutate(dept=fct_recode(dept,
                    "大氣系"="AS",
                    "經濟系"="Econ",
                    "經濟系"="Economics",
                    "經濟系"="經濟",
                    "經濟系"="經濟學",
                    "經濟系"="經濟學系",
                    "電機與電子系"="Electrical Engineering",
                    "電機與電子系"="電機",
                    "電機與電子系"="電子工程系",
                    "電機與電子系"="電機系",
                    "心理相關科系"="psychology",
                    "心理相關科系"="臨床心理學系",
                    "心理相關科系"="諮商與工商心理學系",
                    "心理相關科系"="心理學系",
                    "心理相關科系"="心理與諮商學系",
                    "心理相關科系"="心理系，行銷系與財金系你 你也可以選一個",
                    "心理相關科系"="心理系",
                    "心理相關科系"="心理",
                    "社會社工社教相關科系"="社會學系",
                    "社會社工社教相關科系"="社會福利系",
                    "社會社工社教相關科系"="社會系",
                    "社會社工社教相關科系"="社會工作學系",
                    "社會社工社教相關科系"="社會工作",
                    "社會社工社教相關科系"="社會",
                    "社會社工社教相關科系"="社教系",
                    "社會社工社教相關科系"="社教",
                    "社會社工社教相關科系"="社工系",
                    "社會社工社教相關科系"="人文社會學院學士班",
                    "社會社工社教相關科系"="人文社會",
                    "人類學系"="人類學",
                    "工程相關科系"="土木工程",
                    "工程相關科系"="土木工程學系",
                    "工程相關科系"="工程系統科學",
                    "工程相關科系"="工程科學系",
                    "工程相關科系"="工程與系統科學系",
                    "工程相關科系"="化學工程與材料工程學系",
                    "工程相關科系"="材料科學工程學系",
                    "工程相關科系"="通訊工程",
                    "工程相關科系"="造船及海洋工程系",
                    "工程相關科系"="機械工程系",
                    "工程相關科系"="機械工程學系",
                    "工程相關科系"="機械與機電工程學系",
                    "工程相關科系"="機械",
                    "工程相關科系"="工科系",
                    "工程相關科系"="生工系",
                    "工程相關科系"="材料系",
                    "工程相關科系"="動力機械系",
                    "資訊相關科系"="資工",
                    "資訊相關科系"="資工系",
                    "資訊相關科系"="資訊工程",
                    "資訊相關科系"="資訊工程學系",
                    "資訊相關科系"="資訊經營系",
                    "資訊相關科系"="資訊管理",
                    "資訊相關科系"="資管",
                    "資訊相關科系"="資管系",
                    "設計相關科系"="工業設計",
                    "設計相關科系"="商品設計",
                    "中文系"="中文",
                    "中文系"="國文系",
                    "中文系"="中國文學系",
                    "法律相關科系"="法律學系",
                    "法律相關科系"="法律系",
                    "法律相關科系"="法律",
                    "法律相關科系"="中葡法律",
                    "教育相關科系"="人發",
                    "教育相關科系"="公領",
                    "教育相關科系"="教育科技學系",
                    "教育相關科系"="舞蹈學系、特殊教育研究所",
                    "教育相關科系"="國際漢語教育",
                    "教育相關科系"="特殊教育學系",
                    "教育相關科系"="特殊教育系",
                    "教育相關科系"="幼兒與家庭教育學系",
                    "教育相關科系"="特教系",
                    "教育相關科系"="特教",
                    "公衛系"="公衛",
                    "化學系"="化學",
                    "食品相關科系"="水產食品科學系",
                    "食品相關科系"="食品科學",
                    "食品相關科系"="食品科學系",
                    "牙醫系"="牙醫",
                    "牙醫系"="牙醫學系",
                    "外文相關科系"="外文",
                    "外文相關科系"="外文系",
                    "外文相關科系"="外國語文學系",
                    "外文相關科系"="應用外文系",
                    "外文相關科系"="應用英語系",
                    "外文相關科系"="應用日語系",
                    "外文相關科系"="英語系",
                    "外文相關科系"="英語文系",
                    "外文相關科系"="應英系",
                    "外文相關科系"="西班牙語文學系",
                    "外文相關科系"="西文",
                    "外文相關科系"="西文系",
                    "外文相關科系"="西班牙文學",
                    "外文相關科系"="西班牙文學系",
                    "外文相關科系"="日文系",
                    "外文相關科系"="日文",
                    "生物相關科系"="生化科技",
                    "生物相關科系"="生命科學系",
                    "生物相關科系"="生物醫學系",
                    "生物相關科系"="生科",
                    "生物相關科系"="生科院學士班",
                    "生物相關科系"="動物科學技術學系",
                    "傳播相關科系"="資訊傳播學系",
                    "傳播相關科系"="新聞傳播",
                    "傳播相關科系"="傳播與科技學系",
                    "傳播相關科系"="生物產業傳播暨發展學系",
                    "傳播相關科系"="生傳系",
                    "傳播相關科系"="生傳",
                    "傳播相關科系"="圖傳",
                    "傳播相關科系"="新聞",
                    "傳播相關科系"="媒體",
                    "傳播相關科系"="傳播與科技學系",
                    "傳播相關科系"="廣電系",
                    "管理相關科系"="工業工程與工程管理",
                    "管理相關科系"="工業工程與經營管理",
                    "管理相關科系"="企業管理",
                    "管理相關科系"="企管",
                    "管理相關科系"="保險金融管理系",
                    "管理相關科系"="科管",
                    "管理相關科系"="經管",
                    "管理相關科系"="資訊管理",
                    "管理相關科系"="資管",
                    "管理相關科系"="資管系",
                    "管理相關科系"="運動管理學系",
                    "管理相關科系"="運輸與物流管理學系",
                    "管理相關科系"="管理科學系",
                    "管理相關科系"="醫務管理學系",
                    "物理系"="物理",
                    "文化相關科系"="民俗技藝",
                    "文化相關科系"="公共與文化事務學系",
                    "藝術相關科系"="表藝所",
                    "藝術相關科系"="舞蹈系",
                    "藝術相關科系"="應用美術",
                    "藝術相關科系"="美術",
                    "藝術相關科系"="戲劇",
                    "藝術相關科系"="戲劇系",
                    "藝術相關科系"="戲劇學系",
                    "公衛系"="公衛",
                    "財金系"="財務金融學系",
                    "財金系"="財金",
                    "財金系"="金融系",
                    "財金系"="金融",
                    "政治系"="政治學系",
                    "國企系"="國企",
                    "國企系"="國際企業學系",
                    "園藝系"="園藝",
                    "會計系"="會計",
                    "會計系"="會計學系",
                    "經濟系"="政治學系",
                    "經濟系"="經濟學",
                    "經濟系"="經濟",
                    "經濟系"="經濟學系",
                    "農業化學系"="農化",
                    "治療相關科系"="語言治療與聽力",
                    "治療相關科系"="物理治療",
                    "治療相關科系"="物理治療系",
                    "治療相關科系"="語言治療與聽力學系",
                    "治療相關科系"="職能治療",
                    "治療相關科系"="職能治療學系",
                    "治療相關科系"="聽力與語言治療",
                    "治療相關科系"="聽語系",
                    "數學系"="數學",
                    "歷史系"="歷史",
                    "歷史系"="歷史與地理學系",
                    "歷史系"="歷史 社工",
                    "獸醫系"="獸醫",
                    "藥用化妝品系"="藥用化妝品",
                    "藥用化妝品系"="藥用化妝品學系",
                    "獸醫系"="獸醫",
                    "體育系"="體育學系"))

# remove duplicated & NA rows

dupli_index <- duplicated(psy_test[,-1]) ## return rows that are duplicated by comparing all variables except datetime
#dupli_rows <- psy_test[dupli_index,]
psy_test <- psy_test[!dupli_index, ]  ## rows not duplicated

NA_row <- is.na(psy_test$`3`)
psy_test <- psy_test[!NA_row,]

# write to rds: R's data specific data storage
write_rds(psy_test, "./data/psy_test_parsed.rds")
write_rds(var_info, "./data/item_construct.rds")